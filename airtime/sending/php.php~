<?php

?>

<p>
The PHP code snippet below shows how to send airtime using our API. 
</p>

<p>
The code uses our PHP gateway class: <strong>AfricasTalkingGateway.php</strong> <span class="download_link">[<a href='/smslibraries/php'><i class="ti-download" ></i>  Download</a>]</span>
</p>

<p>
Also, please ensure that you have the php_curl module enabled. To enable it uncomment the line:
<strong>;extension=php_curl.dll</strong> in php.ini and restart apache
</p>

<fieldset style="width:98%" class='boxed code'>
<pre class="phpCode">
&lt;?php

		require_once "AfricasTalkingGateway.php";
		
		//Specify your credentials
		$username = "myAfricasTalkingUsername";
		$apiKey   = "myAfricasTalkingAPIKey";
		
		//Specify the phone number/s and amount in the format shown
		//Example shown assumes we want to send KES 100 to two numbers
		// Please ensure you include the country code for phone numbers (+254 for Kenya in this case)
		
		$recipients = array(
		                array("phoneNumber"=>"+254700XXXYYY", "amount"=>"KES 100"),
					             array("phoneNumber"=>"+254733YYYZZZ", "amount"=>"KES 100")
					           );
		
		//Convert the recipient array into a string. The json string produced will have the format:
		// [{"amount":"KES 100", "phoneNumber":+254700XXXYYY},{"amount":"KES 100", "phoneNumber":+254733YYYZZZ}]
		//A json string with the shown format may be created directly and skip the above steps
		$recipientStringFormat = json_encode($recipients);
		
		//Create an instance of our awesome gateway class and pass your credentials
		$gateway = new AfricasTalkingGateway($username, $apiKey);
		
		// Thats it, hit send and we'll take care of the rest. Any errors will
   // be captured in the Exception class as shown below
   
   try {
   	$results = $gateway->sendAirtime($recipientStringFormat);

   	foreach($results as $result) {
   	 echo $result->status;
   	 echo $result->amount;
   	 echo $result->phoneNumber;
   	 echo $result->discount;
   	 echo $result->requestId;
   	 
   	 //Error message is important when the status is not Success
   	 echo $esult->errorMessage;
   	}
   }
   catch(AfricasTalkingGatewayException $e){
   	echo $e->getMessage();
   }
  
  //Done
</pre>
</fieldset>