<?php

?>
<p>
The PHP code snippet below shows how to fetch messages from our API. 
</p>

<p>
The code uses our PHP gateway class: <strong>AfricasTalkingGateway.php</strong> <span class="download_link">[<a href='/smslibraries/php'><i class="ti-download" ></i>  Download</a>]</span>
</p>

<p>
Also, please ensure that you have the php_curl module enabled. To enable it uncomment the line:
<strong>;extension=php_curl.dll</strong> in php.ini and restart apache
</p>

<fieldset style="width:98%" class='boxed code'>
<pre class="phpCode">

&lt;?php
// Include the helper gateway class
require_once('AfricasTalkingGateway.php');

// Specify your login credentials
$username   = "MyAfricasTalkingUsername";
$apikey     = "MyAfricasTalkingAPIKey";

// Create a new instance of our awesome gateway class
$gateway  = new AfricaStalkingGateway($username, $apikey);

// Any gateway errors will be captured by our custom Exception class below, 
// so wrap the call in a try-catch block
try 
{
  // Our gateway will return 100 messages at a time back to you, starting with
  // what you currently believe is the lastReceivedId. Specify 0 for the first
  // time you access the gateway, and the ID of the last message we sent you
  // on subsequent results
  $lastReceivedId = 0;
  
  // Here is a sample of how to fetch all messages using a while loop
  do {
    
    $results = $gateway->fetchMessages($lastReceivedId);
    foreach($results as $result) {
      
      echo " From: " .$result->from;
      echo " To: " .$result->to;
      echo " Message: ".$result->text;
      echo " Date Sent: " .$result->date;
      echo " LinkId: " .$result->linkId;
      echo " id: ".$result->id;
      echo "\n";
      $lastReceivedId = $result->id;
      
    }
  } while ( count($results) > 0 );
  
  // NOTE: Be sure to save lastReceivedId here for next time
  
}
catch ( AfricasTalkingGatewayException $e )
{
  echo "Encountered an error: ".$e->getMessage();
}
// DONE!!!

</pre>
</fieldset>