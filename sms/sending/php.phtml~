<?php

?>
<h2>Send messages using PHP</h2>
<p>
The PHP code snippet below shows how to send SMS Messages using our API. 
</p>

<p>
The code uses our PHP gateway class: <strong>AfricasTalkingGateway.php</strong> <span class="download_link">[<a href='/smslibraries/php'><i class="ti-download" ></i>  Download</a>]</span>
</p>

<p>
Also, please ensure that you have the php_curl module enabled. To enable it uncomment the line:
<strong>;extension=php_curl.dll</strong> in php.ini and restart apache
</p>

<ul>
<li><a href="#basic" data-toggle="tab">Sending a message</a></li>
<li><a href="#from" data-toggle="tab">Sending message using sender id or shortcode parameter</a></li>
<li><a href="#enqueue" data-toggle="tab">Enqueue messages</a></li>
<li><a href="#premium" data-toggle="tab">Sending premium rated (subscription) messages</a></li>
<li><a href="#ondemand" data-toggle="tab">Sending premium rated (onDemand) messages</a></li>
</ul>

<div class="tab-content">


<div class="tab-pane fade in active" id="basic">
<h3>Sending a Message</h3>
<fieldset style="width:98%" class='boxed code'>
<pre class="phpCode">
&lt;?php
// Be sure to include the file you've just downloaded
require_once('AfricasTalkingGateway.php');

// Specify your login credentials
$username   = "MyAfricasTalkingUsername";
$apikey     = "MyAfricasTalkingAPIKey";

// Specify the numbers that you want to send to in a comma-separated list
// Please ensure you include the country code (+254 for Kenya in this case)
$recipients = "+254711XXXYYY,+254733YYYZZZ";

// And of course we want our recipients to know what we really do
$message    = "I'm a lumberjack and its ok, I sleep all night and I work all day"

// Create a new instance of our awesome gateway class
$gateway    = new AfricasTalkingGateway($username, $apikey);

// Any gateway error will be captured by our custom Exception class below, 
// so wrap the call in a try-catch block

try 
{ 
  // Thats it, hit send and we'll take care of the rest. 
  $results = $gateway->sendMessage($recipients, $message);
			
  foreach($results as $result) {
    // Note that only the Status "Success" means the message was sent
    echo " Number: " .$result->number;
    echo " Status: " .$result->status;
    echo " MessageId: " .$result->messageId;
    echo " Cost: "   .$result->cost."\n";
  }
}
catch ( AfricasTalkingGatewayException $e )
{
  echo "Encountered an error while sending: ".$e->getMessage();
}

// DONE!!! 

</pre>
</fieldset>
</div>

<div class="tab-pane fade" id="from">
<h3>Sending messages: Use short code/Sender id</h3>
<fieldset style="width:98%" class='boxed code'>
<pre class="phpCode">
&lt;?php
//Sending Messages using sender id/short code

require_once('AfricasTalkingGateway.php');

$username   = "MyAfricasTalkingUsername";
$apikey     = "MyAfricasTalkingAPIKey";

$recipients = "+254711XXXYYY,+254733YYYZZZ";

$message    = "I'm a lumberjack and its ok, I sleep all night and I work all day"

// Specify your AfricasTalking shortCode or sender id
$from = "shortCode or senderId";

$gateway    = new AfricasTalkingGateway($username, $apikey);

try 
{
   
   $results = $gateway.sendMessage($recipients, $message, $from);
			
  foreach($results as $result) {
    echo " Number: " .$result->number;
    echo " Status: " .$result->status;
    echo " MessageId: " .$result->messageId;
    echo " Cost: "   .$result->cost."\n";
  }
}
catch ( AfricasTalkingGatewayException $e )
{
  echo "Encountered an error while sending: ".$e->getMessage();
}

// DONE!!! 

</pre>
</fieldset>
</div>

<div class="tab-pane fade" id="enqueue">
<h3>Sending messages: Queue messages to be sent later</h3>
<fieldset style="width:98%" class='boxed code'>
<pre class="phpCode">
&lt;?php
//Message queueing 

require_once('AfricasTalkingGateway.php');

$username   = "MyAfricasTalkingUsername";
$apikey     = "MyAfricasTalkingAPIKey";

$recipients = "+254711XXXYYY,+254733YYYZZZ";

$message    = "I'm a lumberjack and its ok, I sleep all night and I work all day"

$from = null; //$from = "shortCode or senderId";

$bulkSMSMode = 1; // This should always be 1 for bulk messages

// enqueue flag is used to queue messages incase you are sending a high volume.
// The default value is 0.
$options = array("enqueue" => 1);

$gateway    = new AfricasTalkingGateway($username, $apikey);

try 
{
   
   $results = $gateway.sendMessage($recipients, $message, $from, $bulkSMSMode, $options);
			
  foreach($results as $result) {
    echo " Number: " .$result->number;
    echo " Status: " .$result->status;
    echo " MessageId: " .$result->messageId;
    echo " Cost: "   .$result->cost."\n";
  }
}
catch ( AfricasTalkingGatewayException $e )
{
  echo "Encountered an error while sending: ".$e->getMessage();
}

// DONE!!! 

</pre>
</fieldset>
</div>

<div class="tab-pane fade" id="premium">
<h3>Sending premium rated (subscription) messages</h3>
<fieldset style="width:98%" class='boxed code'>
<pre class="phpCode">
&lt;?php
// Sending premium rated messages
require_once('AfricasTalkingGateway.php');

$username   = "MyAfricasTalkingUsername";
$apikey     = "MyAfricasTalkingAPIKey";

$recipients = "+254711XXXYYY,+254722YYYZZZ";

// Specify your premium shortCode and keyword
$shortCode = "XXXXX";
$keyword   = "premiumKeyword";

// Set the bulkSMSMode flag to 0 so that the subscriber gets charged
$bulkSMSMode = 0;

// Create an array which would hold the following parameters:
// keyword: Your premium keyword,
// retryDurationInHours: The numbers of hours our API should retry to send the message 
// incase it doesn't go through. It is optional

$options = array(
            'keyword'              => $keyword,
            'retryDurationInHours' => "No of hours to retry"
           );
           
$message = "No matter what, don't give up";


$gateway    = new AfricasTalkingGateway($username, $apikey);

try 
{ 

  $results = $gateway->sendMessage($recipients, $message, $shortCode, $bulkSMSMode, $options);
  foreach($results as $result) {
    echo " Number: " .$result->number;
    echo " Status: " .$result->status;
    echo " MessageId: " .$result->messageId . "\n";
  }
}
catch ( AfricasTalkingGatewayException $e )
{
  echo "Encountered an error while sending: ".$e->getMessage();
}

// DONE!!! 
</pre>
</fieldset>
</div>

<div class="tab-pane fade" id="ondemand">
<h3>Sending premium rated (onDemand) messages</h3>
<fieldset style="width:98%" class='boxed code'>
<pre class="phpCode">
&lt;?php
// Sending onDemand premium messages
require_once('AfricasTalkingGateway.php');

$username   = "MyAfricasTalkingUsername";
$apikey     = "MyAfricasTalkingAPIKey";

$recipients = "+254711XXXYYY,+254722YYYZZZ";


$shortCode = "XXXXX";
$keyword   = "premiumKeyword"; // $keyword = null;

$bulkSMSMode = 0;

// Create an array which would hold the parameters keyword, retryDurationInHours and linkId
// linkId is received from the message sent by subscriber to your onDemand service
$linkId = "messageLinkId";

$options = array(
            'keyword'             => $keyword,
            'linkId'              => $linkId,
            'retryDurationInHours' => "No of hours to retry"
           );
           
$message = "No matter what, don't give up";

$gateway    = new AfricasTalkingGateway($username, $apikey);

try 
{ 
  $results = $gateway->sendMessage($recipients, $message, $shortCode, $bulkSMSMode, $options);
  foreach($results as $result) {
    echo " Number: " .$result->number;
    echo " Status: " .$result->status;
    echo " MessageId: " .$result->messageId . "\n";
  }
}
catch ( AfricasTalkingGatewayException $e )
{
  echo "Encountered an error while sending: ".$e->getMessage();
}

// DONE!!! 
</pre>
</fieldset>
</div>

</div>