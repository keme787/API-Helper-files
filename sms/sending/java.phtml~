<?php

?>
<h2>Send messages using Java</h2>
<p>
The Java code snippet below shows how to send SMS Messages using our API. 
</p>

<p>
The code uses our Java gateway class: <strong>AfricasTalkingGateway.java</strong> <span class="download_link">[<a href='/smslibraries/java'><i class="ti-download" ></i>  Download</a>]</span>
</p>

<p>
To help decode JSON responses, you will need to add one of the available JAVA libraries as a dependency.
For this tutorial we chose to use <strong>json-20090211.jar</strong> which you can 
<a href = 'http://mvnrepository.com/artifact/org.json/json/20090211'>download from this repository</a>. 
The  documentation on this library 
<a href='http://www.json.org/javadoc/org/json/package-summary.html'>can be found here</a>. 
</p>

<fieldset class='boxed'>
<legend>Note On SSL Certificate Validation Issues</legend>
<p>
Some of our users have experienced SSL Certificate validation issues when connecting to our website due to our use of
https. The error you see may look something like this:
</p>
<p>
<verbatim>
<strong>Unable to find valid certification path to requested target</strong>
</verbatim>
</p>
<p>
Please do not panic! Our certificate is perfectly valid 
(<a href='http://www.sslshopper.com/ssl-checker.html#hostname=api.africastalking.com'>as evidenced by 
these verification tests</a>), and the error you are seeing is quite common amongst Java clients 
connecting to secure websites. Here is how to fix the issue 
(<a href='https://blogs.oracle.com/gc/entry/unable_to_find_valid_certification'>based on this blog</a>)
</p>
<ul class='lgcircle'>
	<li>Download and compile <strong>InstallCert.java</strong> 
		(<a href='http://code.google.com/p/java-use-examples/source/browse/trunk/src/com/aw/ad/util/InstallCert.java'>you can find the code here</a>).</li>
	<li>Run: java InstallCert api.africastalking.com
		<br>This will download a copy of our Certificate and create a file named <strong>jssecacerts</strong> 
		in the current directory.</li>
	<li>You can now add our Certificate to your trusted store by copying the created <strong>jssecacerts</strong> file to the 
		Java security directory under <strong>$JAVA_HOME/jre/lib/security</strong>
	</li>
</li>
</fieldset>


<ul>
<li><a href="#basic" data-toggle="tab">Sending a message</a></li>
<li><a href="#from" data-toggle="tab">Sending message using sender id or shortcode parameter</a></li>
<li><a href="#enqueue" data-toggle="tab">Enqueue messages</a></li>
<li><a href="#premium" data-toggle="tab">Sending premium rated (subscription) messages</a></li>
<li><a href="#ondemand" data-toggle="tab">Sending premium rated (onDemand) messages</a></li>
</ul>

<div class="tab-content">

<div class="tab-pane fade in active" id="basic">
<h3>Sending a Message</h3>

<fieldset style="width:98%" class='boxed code'>
<pre class="javaCode">
/* Make sure the downloaded jar file is in the classpath or has been added to 
   referenced libraries if you are using an SDK like eclipse or netbeans*/
import org.json.*;
import java.util.HashMap;

public class TestSending
{
    public static void main(String[] args_)
    {
	     // Specify your login credentials
	     String username = "MyUsername";
	     String apiKey   = "MyAPIKey";
	
	     // Specify the numbers that you want to send to in a comma-separated list
	     // Please ensure you include the country code (+254 for Kenya in this case)
	     String recipients = "+254711XXXYYY,+254733YYYZZZ";
	
	     // And of course we want our recipients to know what we really do
	     String message = "We are lumberjacks. We code all day and sleep all night";
	
	    // Create a new instance of our awesome gateway class
	     AfricasTalkingGateway gateway  = new AfricasTalkingGateway(username, apiKey);
	
	     // Thats it, hit send and we'll take care of the rest. Any errors will
	     // be captured in the Exception class below
	    try {
	        JSONArray results = gateway.sendMessage(recipients, message);
			
	        for( int i = 0; i < results.length(); ++i ) {
		          JSONObject result = results.getJSONObject(i);
		          System.out.print(result.getString("status") + ",");
		          System.out.print(result.getString("number") + ",");
		          System.out.print(result.getString("messageId") + ",");
		          System.out.println(result.getString("cost"));
	    }
   	}
   	
   	catch (Exception e) {
	    System.out.println("Encountered an error while sending " + e.getMessage());
	    }
	
   }
}

</pre>
</fieldset>
</div>

<div class="tab-pane fade" id="from">
<h3>Sending messages: Use short code/Sender id</h3>
<fieldset style="width:98%" class='boxed code'>
<pre class="javaCode">
// Sending Messages using sender id/short code

import org.json.*;
import java.util.HashMap;

public class TestSending
{
    public static void main(String[] args_)
    {
	     String username = "MyUsername";
	     String apiKey   = "MyAPIKey";
	
	     String recipients = "+254711XXXYYY,+254733YYYZZZ";
	
	     String message = "We are lumberjacks. We code all day and sleep all night";
	     
	     // Specify your AfricasTalking shortCode or sender id
	     String from = "shortCode or senderId";
	
	     AfricasTalkingGateway gateway  = new AfricasTalkingGateway(username, apiKey);
	     
	    try {
	        JSONArray results = gateway.sendMessage(recipients, message, from);
			
	        for( int i = 0; i < results.length(); ++i ) {
		          JSONObject result = results.getJSONObject(i);
		          System.out.print(result.getString("status") + ",");
		          System.out.print(result.getString("number") + ",");
		          System.out.print(result.getString("messageId") + ",");
		          System.out.println(result.getString("cost"));
	    }
   	}
   	
   	catch (Exception e) {
	    System.out.println("Encountered an error while sending " + e.getMessage());
	    }
	
   }
}
</pre>	
</fieldset>
</div>

<div class="tab-pane fade" id="enqueue">
<h3>Sending messages: Queue messages to be sent later</h3>
<fieldset style="width:98%" class='boxed code'>
<pre class="javaCode">
// Message queueing 
import org.json.*;
import java.util.HashMap;

public class TestSending
{
    public static void main(String[] args_)
    {
	     String username = "MyUsername";
	     String apiKey   = "MyAPIKey";
	
	     String recipients = "+254711XXXYYY,+254733YYYZZZ";
	
	     String message = "We are lumberjacks. We code all day and sleep all night";
	     
	     String from = null; //String from = "shortCode or senderId";
	     
	     int bulkSMSMode = 1; // This should always be 1 for bulk messages
	     
	     // enqueue flag is used to queue messages incase you are sending a high volume.
	     // The default value is 0.
	     HashMap<?php echo htmlentities("<String, int>");?> options = new HashMap<?php echo htmlentities("<String, int>");?>();
	     options.put("enqueue", 1);
	
	     AfricasTalkingGateway gateway  = new AfricasTalkingGateway(username, apiKey);
	     
	    try {
	        JSONArray results = gateway.sendMessage(recipients, message, from, bulkSMSMode, options);
			
	        for( int i = 0; i < results.length(); ++i ) {
		          JSONObject result = results.getJSONObject(i);
		          System.out.print(result.getString("status") + ",");
		          System.out.print(result.getString("number") + ",");
		          System.out.print(result.getString("messageId") + ",");
		          System.out.println(result.getString("cost"));
	    }
   	}
   	
   	catch (Exception e) {
	    System.out.println("Encountered an error while sending " + e.getMessage());
	    }
	
   }
}
</pre>	
</fieldset>
</div>

<div class="tab-pane fade" id="premium">
<h3>Sending premium rated (subscription) messages</h3>
<fieldset style="width:98%" class='boxed code'>
<pre class="javaCode">
// Sending premium rated messages
import org.json.*;
import java.util.HashMap;

public class TestSending
{
    public static void main(String[] args_)
    {
    	
	     String username = "MyUsername";
	     String apiKey   = "MyAPIKey";
	     
	     String recipients = "+254711XXXYYY,+254733YYYZZZ";
	     
	     String message = "No matter what, don't give up";
	
	     // Specify your premium shortcode and keyword
	     String shortCode = "XXXXX";
	     String keyword = "premiumKeyword";
	     
	     // Set the bulkSMSMode flag to 0 so that the subscriber get charged
	     int bulkSMSMode = 0;
	     
	     // Create a hashmap which would hold the following parameters:
	     // keyword: Your premium keyword,
	     // retryDurationInHours: The numbers of hours our API should retry to send the message 
	     // incase it doesn't go through. It is optional
	     
	     HashMap<?php echo htmlentities("<String, String>");?> options = new HashMap<?php echo htmlentities("<String, String>");?>();
	     options.put("keyword", keyword);
	     options.put("retryDurationInHours", "No. of hours to retry sending message");
	     
	     AfricasTalkingGateway gateway  = new AfricasTalkingGateway(username, apiKey);
	     
	     try  {
	     	
	        JSONArray results = gateway.sendMessage(recipients, message, from, bulkSMSMode, options);
	        for( int i = 0; i < results.length(); ++i ) {
		          JSONObject result = results.getJSONObject(i);
		          System.out.print(result.getString("status") + ",");
		          System.out.print(result.getString("number") + ",");
		          System.out.print(result.getString("messageId") + ",");
	    }
   	}
   	
   	catch (Exception e) {
	    System.out.println("Encountered an error while sending " + e.getMessage());
	    }
	
   }
}
</pre>
</fieldset>
</div>

<div class="tab-pane fade" id="ondemand">
<h3>Sending premium rated (onDemand) messages</h3>
<fieldset style="width:98%" class='boxed code'>
<pre class="javaCode">
// Sending onDemand premium messages

import org.json.*;
import java.util.HashMap;

public class TestSending
{
    public static void main(String[] args_)
    {
    	
	     String username = "MyUsername";
	     String apiKey   = "MyAPIKey";
	     
	     String recipients = "+254711XXXYYY,+254733YYYZZZ";
	     
	     String message = "No matter what, don't give up";
	
	     String shortCode = "XXXXX";
	     String keyword = "premiumKeyword"; // String keyword = null;
	     
	     int bulkSMSMode = 0;
	     
	     // Create a hashmap which would hold parameters keyword, retryDurationInHours and linkId
	     // linkId is received from the message sent by subscriber to your onDemand service
	     String linkId = "messageLinkId";
	     
	     HashMap<?php echo htmlentities("<String, String>");?> options = new HashMap<?php echo htmlentities("<String, String>");?>();
	     options.put("keyword", keyword);
	     options.put("linkId", linkId);
	     options.put("retryDurationInHours", "No. of hours to retry sending message");
	     
	     AfricasTalkingGateway gateway  = new AfricasTalkingGateway(username, apiKey);
	     
	     try  {
	     	
	        JSONArray results = gateway.sendMessage(recipients, message, from, bulkSMSMode, options);
	        
	        for( int i = 0; i < results.length(); ++i ) {
		          JSONObject result = results.getJSONObject(i);
		          System.out.print(result.getString("status") + ",");
		          System.out.print(result.getString("number") + ",");
		          System.out.print(result.getString("messageId") + ",");
	    }
   	}
   	
   	catch (Exception e) {
	    System.out.println("Encountered an error while sending " + e.getMessage());
	    }
	
   }
}
</pre>
</fieldset>
</div>

</div>